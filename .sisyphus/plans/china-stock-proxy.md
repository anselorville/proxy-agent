# A股金融数据代理服务开发计划

## 项目概述

### 核心目标
开发代理请求的A股市场金融数据服务，通过智能代理轮换和频率控制规避IP封禁，支持全部非ST A股股票（约4500只）的数据收集和下载。

### 技术栈
- 后端：Python + FastAPI
- 数据库：PostgreSQL + TimescaleDB
- 定时任务：Celery + Redis
- 代理管理：requests + 代理池轮换
- 部署：阿里云服务器（4CPU/8GB）

### 关键功能
1. 代理增强的数据获取（规避IP封禁）
2. 定时/手动数据更新（15:05自动执行）
3. Bearer Token认证的API下载接口
4. 支持时间区间和股票代码过滤
5. 前复权日线数据（最近3年）

## 执行计划

### 波次1：基础架构
1. **项目初始化**：创建Python虚拟环境，依赖管理，项目结构
2. **代理池实现**：requests + 代理轮换 + User-Agent随机化 + 频率控制
3. **数据库设计**：PostgreSQL + TimescaleDB，金融时间序列表结构

### 波次2：核心服务
4. **数据获取引擎**：akshare集成，错误处理，重试机制
5. **FastAPI框架**：JWT认证，API端点，数据序列化
6. **定时任务系统**：Celery配置，15:05定时任务，手动触发

### 波次3：集成部署
7. **完整集成**：端到端测试，性能优化，监控配置
8. **部署准备**：Docker配置，环境变量，阿里云部署

## 关键决策确认

### 已确定的决策
- 股票范围：全部非ST的A股股票（约4500只）
- 服务器规格：阿里云 4CPU/8GB
- 数据范围：最近3年，前复权
- 复权类型：前复权
- 代理方案：自建代理池 + 频率控制
- 认证方案：Bearer Token（JWT）

### 应用的默认值
- 代理池大小：5个代理轮换
- 请求间隔：2秒/请求
- 错误重试：3次，指数退避
- API限流：10请求/分钟/用户
- 分页大小：100条/页

## 验证策略

### 手动验证要求
每个任务需要详细的手动验证步骤，包括：
1. 命令执行和输出验证
2. API请求和响应验证
3. 数据库数据完整性检查
4. 定时任务执行验证

### 验证证据要求
- 终端命令输出的完整记录
- API响应体的完整内容
- 数据库查询结果的截图
- 定时任务执行日志

## 风险控制

### 技术风险
1. **IP封禁规避有效性**：通过多代理轮换+频率控制缓解
2. **数据源稳定性**：akshare备用方案（tushare/baostock）
3. **大规模数据处理**：分批处理，增量更新

### 实施风险
1. **代理池维护**：定期验证代理有效性
2. **数据完整性**：实现数据验证和修复机制
3. **性能瓶颈**：监控和优化数据获取性能

## 下一步

计划已准备就绪。请运行以下命令开始执行：

```bash
/start-work
```

这将：
1. 注册此计划为活动项目
2. 开始跟踪执行进度
3. 按3波次并行执行任务
4. 预计总时间：4-5周

**重要**：执行过程中如需调整计划，请随时告知。